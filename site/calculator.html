<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CO2 Emissions Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        input, output {
            margin-bottom: 15px;
        }

        .tree-slider {
            margin-bottom: 30px;
            background-color: #aaaaaa;
        }

        .result-section, .input-section {
            display: flex;
            justify-content: flex-start;
            align-items: baseline;
            margin-bottom: 10px;
        }

        input[type=number]::-webkit-inner-spin-button,  
        input[type=number]::-webkit-outer-spin-button {  
            -webkit-appearance: none;  
            margin:  0;  
        }

        input[type=number] {
            -moz-appearance: textfield;
            appearance: textfield;
        }
    </style>
</head>
<body>
    <h1>CO2 Emissions Calculator</h1>

    <!-- Input sections for CO2 emissions, number of trees, and budget -->
    <div class="input-section">
        <label for="co2Input">CO2 Emissions:&nbsp;</label>
        <input type="number" id="co2Input" placeholder="Enter CO2 emissions" aria-labelledby="co2Label" />
        &nbsp;tons
    </div>

    <div class="input-section">
        <label for="numberOfTreesInput">Number of trees:&nbsp;</label>
        <input type="number" id="numberOfTreesInput" placeholder="Enter number of trees" aria-labelledby="numberOfTreesLabel" />
    </div>

    <div class="input-section">
        <label for="budgetInput">Budget:&nbsp;</label>
        <input type="number" id="budgetInput" placeholder="Enter budget" aria-labelledby="budgetLabel" />
        &nbsp;$
    </div>

    <!-- Dynamic tree sliders generated with JavaScript -->
    <div id="treeSlidersContainer"></div>

    <h2>Results</h2>

    <!-- Results sections for net CO2 emissions and total price -->
    <div class="result-section">
        <div id="resultCO2Label">Net CO2 Emissions:&nbsp;</div>
        <output id="resultCO2" aria-labelledby="resultCO2Label">0 tons</output>
    </div>

    <div class="result-section">
        <div id="totalPriceLabel">Total Price:&nbsp;</div>
        <output id="totalPrice" aria-labelledby="totalPriceLabel">$0</output>
    </div>

    <script>
        const sliderScalar = 1.01157945426;
        let numTrees = 3;

        // Function to dynamically create tree sliders
        function createTreeSliders(numTrees) {
            const treeSlidersContainer = document.getElementById('treeSlidersContainer');
            treeSlidersContainer.innerHTML = '';

            for (let i = 1; i <= numTrees; i++) {
                const treeId = `tree${i}`;
                const checkboxId = `${treeId}Checkbox`;

                // Create tree slider elements
                const treeSlider = document.createElement('div');
                treeSlider.className = 'tree-slider';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = checkboxId;
                checkbox.onclick = () => toggleTree(treeId);

                const label = document.createElement('label');
                label.htmlFor = checkboxId;
                label.textContent = `Enable Tree Type ${i}`;

                const slider = document.createElement('input');
                slider.type = 'range';
                slider.id = treeId;
                slider.min = '0';
                slider.max = '1000';
                slider.step = '1';
                slider.value = '0';
                slider.ariaLabelledby = `${treeId}Label`;
                slider.disabled = true;

                const output = document.createElement('output');
                output.id = `${treeId}Output`;
                output.textContent = '0 Trees';

                // Append elements to the tree slider container
                treeSlider.appendChild(checkbox);
                treeSlider.appendChild(label);
                treeSlider.appendChild(slider);
                treeSlider.appendChild(output);
                treeSlidersContainer.appendChild(treeSlider);

                // Add event listener for each tree slider
                slider.addEventListener('input', function () {
                    updateTreeQuantity(treeId, `${treeId}Output`);
                });
            }
        }

        // Function to toggle tree slider
        function toggleTree(treeId) {
            const checkbox = document.getElementById(treeId + 'Checkbox');
            const slider = document.getElementById(treeId);
            slider.disabled = !checkbox.checked;

            if (checkbox.checked) {
                // Enable the slider when the checkbox is checked
                slider.value = 0; // Reset the slider value
                updateTreeQuantity(treeId, treeId + 'Output');
            } else {
                // Disable the slider and update quantity when the checkbox is unchecked
                slider.value = 0;
                updateTreeQuantity(treeId, treeId + 'Output');
            }

            // Recalculate results
            calculateResults();
        }

        // Function to update tree quantity output
        function updateTreeQuantity(sliderId, outputId) {
            const slider = document.getElementById(sliderId);
            const output = document.getElementById(outputId);
            const sliderValue = Math.round(Math.pow(sliderScalar, slider.value));
            output.textContent = `${sliderValue - 1} Trees`;
            calculateResults();
        }

        // Function to calculate and update results
        function calculateResults() {
            const co2Input = parseFloat(document.getElementById('co2Input').value) || 0;
            let totalCO2Reduction = 0;
            let totalPrice = 0;

            // Loop through each tree type
            for (let i = 1; i <= numTrees; i++) {
                const treeId = `tree${i}`;

                // Get tree quantity
                const treeQuantity = parseInt(document.getElementById(treeId + 'Output').textContent.split(" ")[0]) || 0;

                // Get CO2 absorption rate and price from getPricePerTree function
                const treeCO2Absorption = i * 5; // Replace with actual CO2 absorption rate
                const treePrice = getPricePerTree(treeId);

                // Update total CO2 reduction and price
                totalCO2Reduction += treeQuantity * treeCO2Absorption;
                totalPrice += treeQuantity * treePrice;
            }

            // Update results
            const resultCO2 = document.getElementById('resultCO2');
            const totalPriceOutput = document.getElementById('totalPrice');
            resultCO2.textContent = `${co2Input - totalCO2Reduction} tons`;
            totalPriceOutput.textContent = `$${totalPrice}`;
        }

        // Event listeners for tree sliders
        for (let i = 1; i <= numTrees; i++) {
            const treeId = `tree${i}`;
            const sliderId = `${treeId}`;

            // Event listener for each tree slider
            document.getElementById(sliderId).addEventListener('input', function () {
                updateTreeQuantity(treeId, `${treeId}Output`);
            });
        }

        // Event listener for CO2 input
        document.getElementById('co2Input').addEventListener('input', function () {
            calculateResults();
        });

        // Event listener for number of trees input
        document.getElementById('numberOfTreesInput').addEventListener('input', function () {
            numTrees = parseFloat(this.value) || 0;
            createTreeSliders(numTrees);
        });

        // Function to update tree quantity based on budget
        function updateTreeQuantityFromBudget(sliderId, outputId) {
            const slider = document.getElementById(sliderId);
            const output = document.getElementById(outputId);
            const sliderValue = Math.round(Math.pow(sliderScalar, slider.value));
            output.textContent = `${sliderValue-1} Trees`;
            calculateResults();
        }

        // Event listener for budget input
        document.getElementById('budgetInput').addEventListener('input', function () {
            const budgetInputValue = parseFloat(this.value) || 0;

            // Enable at least one tree if none are checked
            const checkedTrees = ['tree1Checkbox', 'tree2Checkbox', 'tree3Checkbox'].filter(id => document.getElementById(id).checked);
            if (checkedTrees.length === 0) {
                document.getElementById('tree1Checkbox').checked = true;
                toggleTree('tree1');
            }

            // Calculate the adjusted number of trees based on budget
            checkedTrees.forEach(treeId => {
                const sliderId = treeId.replace('Checkbox', '');
                const pricePerTree = getPricePerTree(sliderId);

                // Adjusted tree quantity based on budget and price per tree and number of tree types enabled
                const adjustedTreeQuantity = Math.floor(budgetInputValue / pricePerTree) / checkedTrees.length;

                // Update the slider and tree quantity output
                document.getElementById(sliderId).value = Math.log(adjustedTreeQuantity + 1) / Math.log(sliderScalar);
                updateTreeQuantity(sliderId, `${sliderId}Output`);
            });

            // Recalculate results
            calculateResults();
        });

        // Function to get the price per tree
        function getPricePerTree(treeId) {
            switch (treeId) {
                case 'tree1':
                    return 5; // Replace with the actual price for Tree Type 1
                case 'tree2':
                    return 8; // Replace with the actual price for Tree Type 2
                case 'tree3':
                    return 10; // Replace with the actual price for Tree Type 3
                default:
                    console.error(`Unknown treeId: ${treeId}`);
            }
        }

        // Initial calculations
        createTreeSliders(numTrees); // Set the initial number of tree sliders
        calculateResults();
    </script>
</body>
</html>
